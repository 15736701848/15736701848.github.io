<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>庞和合的博客</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
            padding: 15px;
            max-width: 800px;
            margin: 0 auto;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #e0e6ed;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #1a73e8;
        }
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 15px;
        }
        .btn-primary {
            background: #1a73e8;
            color: white;
        }
        .btn-primary:hover {
            background: #1765cc;
        }
        .btn-outline {
            background: transparent;
            border: 1px solid #1a73e8;
            color: #1a73e8;
        }
        .btn-outline:hover {
            background: #e8f0fe;
        }
        .btn-danger {
            background: #d93025;
            color: white;
        }
        .btn-danger:hover {
            background: #c5221f;
        }
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .search-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 15px;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #e0e6ed;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .card h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #202124;
        }
        .card p {
            color: #5f6368;
            font-size: 15px;
            margin-bottom: 15px;
        }
        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .category {
            display: inline-block;
            padding: 4px 12px;
            background: #e8f0fe;
            color: #1a73e8;
            border-radius: 14px;
            font-size: 14px;
        }
        .actions {
            display: flex;
            gap: 8px;
        }
        .editor {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e0e6ed;
        }
        .editor-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 15px;
        }
        .form-group textarea {
            min-height: 300px;
            resize: vertical;
            font-family: monospace;
        }
        .markdown-container {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        .markdown-col {
            flex: 1;
        }
        .editor-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        #preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            min-height: 300px;
            border: 1px solid #e0e6ed;
        }
        .article-view {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e0e6ed;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #202124;
            color: white;
            padding: 12px 24px;
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        .hidden {
            display: none;
        }
        .categories-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        .category-tag {
            background: #e8f0fe;
            color: #1a73e8;
            padding: 5px 12px;
            border-radius: 14px;
            display: flex;
            align-items: center;
        }
        .delete-category {
            background: none;
            border: none;
            color: #d93025;
            cursor: pointer;
            margin-left: 8px;
            font-weight: bold;
        }
        .article-content {
            padding: 20px 0;
            line-height: 1.8;
        }
        .article-content p {
            margin-bottom: 20px;
        }
        .view-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        .preview-toggle {
            background: #f1f3f4;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        .preview-toggle:hover {
            background: #e8eaed;
        }
        .panel {
            display: none;
        }
        .panel.active {
            display: block;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">庞和合的博客</div>
        <div>
            <button class="btn btn-primary" id="new-article">写文章</button>
        </div>
    </header>

    <!-- 文章列表 -->
    <div id="articles-panel" class="panel active">
        <div class="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="搜索文章...">
            <button class="btn btn-primary" id="search-btn">搜索</button>
        </div>
        
        <div id="articles-list">
            <!-- 文章列表将在这里动态生成 -->
        </div>
        
        <!-- 分类管理 -->
        <div class="card">
            <h3>分类管理</h3>
            <div class="categories-panel" id="categories-list">
                <!-- 分类列表将在这里动态生成 -->
            </div>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <input type="text" id="new-category" class="form-control" placeholder="新分类名称">
                <button class="btn btn-primary" id="add-category">添加</button>
            </div>
        </div>
    </div>
    
    <!-- 文章编辑器 -->
    <div id="editor-panel" class="panel">
        <div class="editor">
            <div class="editor-header">
                <h2 id="editor-title">编辑文章</h2>
                <div>
                    <button class="preview-toggle" id="preview-toggle">预览模式</button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="editor-label">标题</label>
                <input type="text" class="form-control" id="title">
            </div>
            
            <div class="form-group">
                <label class="editor-label">分类</label>
                <select class="form-control" id="category">
                    <!-- 分类选项将在这里动态生成 -->
                </select>
            </div>
            
            <div class="markdown-container">
                <div class="markdown-col">
                    <label class="editor-label">内容 (Markdown)</label>
                    <textarea class="form-control" id="content"></textarea>
                </div>
                <div class="markdown-col">
                    <label class="editor-label">预览</label>
                    <div id="preview"></div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" id="save-article">保存</button>
                <button class="btn btn-outline" id="cancel-edit">取消</button>
            </div>
        </div>
    </div>
    
    <!-- 文章阅读视图 -->
    <div id="article-panel" class="panel">
        <div class="article-view">
            <h2 id="article-title">文章标题</h2>
            <div class="category" id="article-category">分类</div>
            
            <div class="article-content" id="article-content">
                <p>这是文章的详细内容...</p>
            </div>
            
            <div class="view-actions">
                <button class="btn btn-outline" id="edit-article">编辑</button>
                <button class="btn btn-outline" id="back-list">返回列表</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>
    
    <script>
        // 博客数据存储
        const blogData = {
            articles: [],
            categories: ['技术', '生活', '随笔']
        };

        // 当前操作的文章
        let currentArticle = null;

        // DOM元素引用
        const elements = {
            articlesPanel: document.getElementById('articles-panel'),
            editorPanel: document.getElementById('editor-panel'),
            articlePanel: document.getElementById('article-panel'),
            articlesList: document.getElementById('articles-list'),
            categoriesList: document.getElementById('categories-list'),
            searchInput: document.getElementById('search-input'),
            searchBtn: document.getElementById('search-btn'),
            newArticleBtn: document.getElementById('new-article'),
            saveArticleBtn: document.getElementById('save-article'),
            cancelEditBtn: document.getElementById('cancel-edit'),
            editArticleBtn: document.getElementById('edit-article'),
            backListBtn: document.getElementById('back-list'),
            addCategoryBtn: document.getElementById('add-category'),
            previewToggle: document.getElementById('preview-toggle'),
            titleInput: document.getElementById('title'),
            contentTextarea: document.getElementById('content'),
            categorySelect: document.getElementById('category'),
            newCategoryInput: document.getElementById('new-category'),
            previewDiv: document.getElementById('preview'),
            articleTitle: document.getElementById('article-title'),
            articleCategory: document.getElementById('article-category'),
            articleContent: document.getElementById('article-content'),
            toast: document.getElementById('toast')
        };

        // 初始化函数
        function init() {
            // 添加示例数据
            addSampleData();
            
            // 渲染初始界面
            renderArticles();
            renderCategories();
            
            // 绑定事件
            bindEvents();
        }

        // 添加示例数据
        function addSampleData() {
            blogData.articles = [
                {
                    id: 1,
                    title: '欢迎使用博客系统',
                    category: '技术',
                    content: '## 欢迎使用庞和合的博客\n\n这是一个简洁高效的博客系统，专注于核心功能：\n\n- **文章管理**：增删查改\n- **分类管理**：添加/删除分类\n- **文章搜索**：快速找到所需内容\n\n> 使用Markdown语法书写文章'
                },
                {
                    id: 2,
                    title: 'Markdown使用指南',
                    category: '技术',
                    content: '## Markdown使用指南\n\n### 标题\n`# 一级标题` `## 二级标题`\n\n### 列表\n- 无序列表\n1. 有序列表\n\n### 引用\n> 引用内容\n\n### 代码块\n```\nfunction hello() {\n  console.log("Hello world!");\n}\n```'
                }
            ];
        }

        // 绑定所有事件
        function bindEvents() {
            // 文章列表相关事件
            elements.newArticleBtn.addEventListener('click', newArticle);
            elements.searchBtn.addEventListener('click', searchArticles);
            elements.searchInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') searchArticles();
            });
            
            // 编辑器相关事件
            elements.saveArticleBtn.addEventListener('click', saveArticle);
            elements.cancelEditBtn.addEventListener('click', cancelEdit);
            elements.previewToggle.addEventListener('click', togglePreviewMode);
            elements.contentTextarea.addEventListener('input', updatePreview);
            
            // 文章阅读相关事件
            elements.editArticleBtn.addEventListener('click', editCurrentArticle);
            elements.backListBtn.addEventListener('click', showArticleList);
            
            // 分类管理相关事件
            elements.addCategoryBtn.addEventListener('click', addCategory);
        }

        // 显示面板
        function showPanel(panelId) {
            // 隐藏所有面板
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // 显示指定面板
            document.getElementById(panelId).classList.add('active');
        }

        // 显示消息提示
        function showToast(message) {
            elements.toast.textContent = message;
            elements.toast.style.opacity = '1';
            
            setTimeout(() => {
                elements.toast.style.opacity = '0';
            }, 3000);
        }

        // 渲染文章列表
        function renderArticles(articles = blogData.articles) {
            elements.articlesList.innerHTML = '';
            
            if (articles.length === 0) {
                elements.articlesList.innerHTML = '<div class="card">暂无文章</div>';
                return;
            }
            
            articles.forEach(article => {
                const articleElement = document.createElement('div');
                articleElement.className = 'card';
                articleElement.innerHTML = `
                    <h3>${article.title}</h3>
                    <p>${article.content.substring(0, 80)}...</p>
                    <div class="card-footer">
                        <div class="category">${article.category}</div>
                        <div class="actions">
                            <button class="btn btn-outline read-btn" data-id="${article.id}">阅读</button>
                            <button class="btn btn-outline edit-btn" data-id="${article.id}">编辑</button>
                            <button class="btn btn-danger delete-btn" data-id="${article.id}">删除</button>
                        </div>
                    </div>
                `;
                elements.articlesList.appendChild(articleElement);
            });
            
            // 添加事件监听
            document.querySelectorAll('.read-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = btn.getAttribute('data-id');
                    readArticle(id);
                });
            });
            
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = btn.getAttribute('data-id');
                    editArticle(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = btn.getAttribute('data-id');
                    deleteArticle(id);
                });
            });
        }

        // 渲染分类列表
        function renderCategories() {
            elements.categoriesList.innerHTML = '';
            
            blogData.categories.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.className = 'category-tag';
                categoryElement.innerHTML = `
                    ${category}
                    <button class="delete-category" data-category="${category}">×</button>
                `;
                elements.categoriesList.appendChild(categoryElement);
            });
            
            // 添加事件监听
            document.querySelectorAll('.delete-category').forEach(btn => {
                btn.addEventListener('click', () => {
                    const category = btn.getAttribute('data-category');
                    deleteCategory(category);
                });
            });
            
            // 更新编辑器中的分类选择
            elements.categorySelect.innerHTML = '';
            blogData.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                elements.categorySelect.appendChild(option);
            });
        }

        // 新建文章
        function newArticle() {
            currentArticle = null;
            elements.titleInput.value = '';
            elements.contentTextarea.value = '';
            elements.categorySelect.selectedIndex = 0;
            elements.previewDiv.innerHTML = '';
            document.getElementById('editor-title').textContent = '创建新文章';
            showPanel('editor-panel');
            elements.titleInput.focus();
        }

        // 编辑文章
        function editArticle(id) {
            const article = blogData.articles.find(a => a.id === parseInt(id));
            if (article) {
                currentArticle = article;
                elements.titleInput.value = article.title;
                elements.contentTextarea.value = article.content;
                
                // 设置分类
                const categorySelect = elements.categorySelect;
                for (let i = 0; i < categorySelect.options.length; i++) {
                    if (categorySelect.options[i].value === article.category) {
                        categorySelect.selectedIndex = i;
                        break;
                    }
                }
                
                // 更新预览
                updatePreview();
                
                document.getElementById('editor-title').textContent = '编辑文章';
                showPanel('editor-panel');
            }
        }

        // 阅读文章
        function readArticle(id) {
            const article = blogData.articles.find(a => a.id === parseInt(id));
            if (article) {
                currentArticle = article;
                elements.articleTitle.textContent = article.title;
                elements.articleCategory.textContent = article.category;
                
                // 将Markdown渲染为HTML
                elements.articleContent.innerHTML = marked.parse(article.content);
                
                showPanel('article-panel');
            }
        }

        // 编辑当前阅读的文章
        function editCurrentArticle() {
            if (currentArticle) {
                editArticle(currentArticle.id);
            }
        }

        // 保存文章
        function saveArticle() {
            const title = elements.titleInput.value.trim();
            const content = elements.contentTextarea.value.trim();
            const category = elements.categorySelect.value;
            
            if (!title) {
                showToast('请输入标题');
                return;
            }
            
            if (!content) {
                showToast('请输入内容');
                return;
            }
            
            if (currentArticle) {
                // 更新现有文章
                currentArticle.title = title;
                currentArticle.content = content;
                currentArticle.category = category;
                showToast('文章已更新');
            } else {
                // 创建新文章
                const newArticle = {
                    id: Date.now(),
                    title,
                    content,
                    category,
                    createdAt: new Date().toLocaleString()
                };
                blogData.articles.unshift(newArticle);
                showToast('文章已创建');
            }
            
            // 更新显示
            renderArticles();
            showPanel('articles-panel');
        }

        // 取消编辑
        function cancelEdit() {
            showPanel('articles-panel');
        }

        // 删除文章
        function deleteArticle(id) {
            if (confirm('确定要删除这篇文章吗？')) {
                blogData.articles = blogData.articles.filter(a => a.id !== parseInt(id));
                renderArticles();
                showToast('文章已删除');
            }
        }

        // 添加分类
        function addCategory() {
            const category = elements.newCategoryInput.value.trim();
            
            if (!category) {
                showToast('请输入分类名称');
                return;
            }
            
            if (blogData.categories.includes(category)) {
                showToast('该分类已存在');
                return;
            }
            
            blogData.categories.push(category);
            renderCategories();
            elements.newCategoryInput.value = '';
            showToast('分类已添加');
        }

        // 删除分类
        function deleteCategory(category) {
            if (confirm(`确定要删除分类"${category}"吗？相关文章将移动到未分类`)) {
                // 移除分类
                blogData.categories = blogData.categories.filter(c => c !== category);
                
                // 更新文章分类
                blogData.articles.forEach(article => {
                    if (article.category === category) {
                        article.category = blogData.categories[0] || '未分类';
                    }
                });
                
                renderCategories();
                renderArticles();
                showToast('分类已删除');
            }
        }

        // 搜索文章
        function searchArticles() {
            const query = elements.searchInput.value.toLowerCase().trim();
            
            if (!query) {
                renderArticles();
                return;
            }
            
            const filteredArticles = blogData.articles.filter(article => {
                return (
                    article.title.toLowerCase().includes(query) || 
                    article.content.toLowerCase().includes(query) ||
                    article.category.toLowerCase().includes(query)
                );
            });
            
            renderArticles(filteredArticles);
        }

        // 显示文章列表
        function showArticleList() {
            showPanel('articles-panel');
        }

        // Markdown预览更新
        function updatePreview() {
            if (typeof marked !== 'undefined') {
                const content = elements.contentTextarea.value;
                elements.previewDiv.innerHTML = marked.parse(content || '**输入内容将在这里预览**');
            }
        }

        // 切换预览模式
        function togglePreviewMode() {
            const editor = elements.contentTextarea;
            const preview = elements.previewDiv;
            
            if (editor.style.display === 'none') {
                // 切换到编辑模式
                editor.style.display = 'block';
                preview.style.display = 'none';
                elements.previewToggle.textContent = '预览模式';
            } else {
                // 切换到预览模式
                editor.style.display = 'none';
                preview.style.display = 'block';
                elements.previewToggle.textContent = '编辑模式';
                updatePreview();
            }
        }

        // 初始化Marked.js
        function initMarked() {
            if (typeof marked === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/marked/marked.min.js';
                script.onload = () => {
                    marked.setOptions({
                        breaks: true,
                        gfm: true
                    });
                    // 初始化后更新预览
                    updatePreview();
                };
                document.head.appendChild(script);
            } else {
                updatePreview();
            }
        }

        // 页面加载时初始化
        window.addEventListener('DOMContentLoaded', () => {
            init();
            initMarked();
        });
    </script>
</body>
</html>
