<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>庞和合的博客</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4CAF50;
            --danger: #f44336;
            --gray: #6c757d;
            --sidebar-width: 280px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: #f5f7fa;
            color: var(--dark);
            display: flex;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* 侧边栏样式 */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(135deg, #3a7bd5, #3a6073);
            color: white;
            padding: 25px;
            height: 100vh;
            position: sticky;
            top: 0;
            display: flex;
            flex-direction: column;
            box-shadow: 3px 0 10px rgba(0,0,0,0.1);
            overflow: hidden;
            z-index: 100;
        }
        
        .sidebar-header {
            display: flex;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 25px;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }
        
        .logo i {
            font-size: 24px;
        }
        
        .blog-title {
            font-size: 1.4rem;
            font-weight: 600;
        }
        
        .create-btn {
            background: var(--success);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 12px 20px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            width: 100%;
            margin: 15px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .create-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .sidebar-section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .section-title i {
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.3s;
        }
        
        .section-title i:hover {
            opacity: 1;
        }
        
        .items-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .category-item, .post-item {
            padding: 10px 15px;
            border-radius: 8px;
            margin: 8px 0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .category-item {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .post-item {
            background: rgba(255, 255, 255, 0.07);
        }
        
        .category-item:hover, .post-item:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .category-item.active, .post-item.active {
            background: rgba(255, 255, 255, 0.2);
            font-weight: 600;
            box-shadow: inset 3px 0 0 white;
        }
        
        .item-actions {
            display: flex;
            gap: 8px;
        }
        
        .item-actions i {
            font-size: 0.9rem;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .item-actions i:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .counter {
            background: var(--accent);
            color: white;
            font-size: 0.75rem;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
        }
        
        /* 主内容区域 */
        .main-content {
            flex-grow: 1;
            padding: 40px;
            max-width: calc(100% - var(--sidebar-width));
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header h1 i {
            color: var(--accent);
        }
        
        .posts-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
        }
        
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 50px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #e0e0e0;
        }
        
        .post-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.07);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .post-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            height: 150px;
            background: linear-gradient(120deg, var(--accent), var(--primary));
            position: relative;
            overflow: hidden;
        }
        
        .category-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.9);
            color: var(--primary);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .card-content {
            padding: 20px;
            flex-grow: 1;
        }
        
        .card-content h3 {
            font-size: 1.4rem;
            margin-bottom: 12px;
            color: var(--dark);
            line-height: 1.4;
        }
        
        .card-content p {
            color: var(--gray);
            font-size: 0.95rem;
            margin-bottom: 20px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .card-footer {
            padding: 15px 20px;
            border-top: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* 模态框样式 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 750px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            transform: translateY(-30px);
            transition: transform 0.3s;
            display: flex;
            flex-direction: column;
        }
        
        .modal.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 18px 25px;
            background: var(--primary);
            color: white;
        }
        
        .modal-header h2 {
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .modal-body {
            padding: 25px;
            overflow-y: auto;
            flex-grow: 1;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .form-control {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            min-height: 400px;
            margin-top: 15px;
        }
        
        .markdown-editor, .markdown-preview {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 18px;
            background: white;
            overflow-y: auto;
        }
        
        .markdown-preview {
            background: #f8f9ff;
        }
        
        textarea {
            min-height: 360px;
            resize: none;
            font-family: 'Consolas', monospace;
            font-size: 15px;
            line-height: 1.6;
        }
        
        .modal-footer {
            padding: 18px 25px;
            background: #f9f9f9;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            border-top: 1px solid #eee;
        }
        
        .btn {
            padding: 12px 26px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            border: none;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--secondary);
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--gray);
            color: var(--gray);
        }
        
        .btn-outline:hover {
            background: #f5f5f5;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: #d32f2f;
        }

        /* 数据管理面板 */
        .data-panel {
            background: rgba(0, 0, 0, 0.7);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .data-panel.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .data-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        .data-content h2 {
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .data-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .data-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border-radius: 8px;
            background: #f5f7fa;
            border: 1px solid #e0e0e0;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .data-btn:hover {
            background: #eef2f7;
            border-color: var(--accent);
        }
        
        .data-btn i {
            font-size: 1.2rem;
            color: var(--primary);
        }
        
        /* 响应式设计 */
        @media (max-width: 1024px) {
            .editor-container {
                grid-template-columns: 1fr;
                min-height: 700px;
            }
            
            .posts-container {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .main-content {
                max-width: 100%;
                padding: 25px;
            }
            
            .posts-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- 侧边栏 -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-blog"></i>
            </div>
            <div class="blog-title">庞和合的博客</div>
        </div>
        
        <button class="create-btn" id="createPostBtn">
            <i class="fas fa-plus-circle"></i> 新建博客文章
        </button>
        
        <div class="sidebar-section">
            <div class="section-title">
                <span>所有文章</span>
                <span class="counter" id="postCounter">0</span>
            </div>
            <ul class="items-list" id="postList">
                <!-- 文章列表动态生成 -->
            </ul>
        </div>
        
        <div class="sidebar-section">
            <div class="section-title">
                <span>分类管理</span>
                <i class="fas fa-plus-circle" id="createCategoryBtn"></i>
            </div>
            <ul class="items-list" id="categoryList">
                <!-- 分类列表动态生成 -->
            </ul>
        </div>
        
        <div class="sidebar-section">
            <div class="section-title">
                <span>数据管理</span>
                <i class="fas fa-database" id="dataManagementBtn"></i>
            </div>
            <div class="items-list">
                <div style="padding: 10px 15px; color: rgba(255,255,255,0.9); font-size: 0.95rem;">
                    <p id="storageInfo">正在读取数据...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 主内容区 -->
    <div class="main-content">
        <div class="header">
            <h1><i class="fas fa-feather-alt"></i> 博客文章</h1>
        </div>
        
        <div class="posts-container" id="postsContainer">
            <!-- 博客文章动态生成 -->
            <div class="empty-state" id="emptyState">
                <i class="fas fa-file-alt"></i>
                <h3>暂无博客文章</h3>
                <p>点击"新建博客文章"按钮开始撰写</p>
            </div>
        </div>
    </div>
    
    <!-- 文章编辑模态框 -->
    <div class="modal" id="postModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> 编辑博客文章</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="postTitle">文章标题</label>
                    <input type="text" id="postTitle" class="form-control" placeholder="输入文章标题">
                </div>
                
                <div class="form-group">
                    <label for="postCategory">选择分类</label>
                    <select id="postCategory" class="form-control">
                        <!-- 分类选项动态生成 -->
                    </select>
                </div>
                
                <div class="editor-container">
                    <div class="markdown-editor">
                        <label for="postContent">Markdown内容</label>
                        <textarea id="postContent" class="form-control" placeholder="使用Markdown语法编写内容..."></textarea>
                    </div>
                    <div class="markdown-preview">
                        <label>实时预览</label>
                        <div id="previewArea">
                            <p style="color:#888;">预览内容将在这里显示...</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelPostBtn">取消</button>
                <button class="btn btn-danger" id="deletePostBtn">删除</button>
                <button class="btn btn-primary" id="savePostBtn">保存文章</button>
            </div>
        </div>
    </div>
    
    <!-- 分类管理模态框 -->
    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-tag"></i> 管理分类</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="categoryName">分类名称</label>
                    <input type="text" id="categoryName" class="form-control" placeholder="输入分类名称">
                </div>
                
                <div class="form-group">
                    <label>已有分类</label>
                    <div style="background: #f9f9f9; border-radius: 8px; padding: 15px; margin-top: 5px; max-height: 200px; overflow-y: auto;">
                        <ul id="existingCategories" style="list-style: none;">
                            <!-- 已有分类动态生成 -->
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelCategoryBtn">取消</button>
                <button class="btn btn-danger" id="deleteCategoryBtn">删除</button>
                <button class="btn btn-primary" id="saveCategoryBtn">保存分类</button>
            </div>
        </div>
    </div>

    <!-- 数据管理面板 -->
    <div class="data-panel" id="dataPanel">
        <div class="data-content">
            <h2><i class="fas fa-database"></i> 数据管理</h2>
            <div class="data-actions">
                <button class="data-btn" id="exportDataBtn">
                    <i class="fas fa-file-export"></i> 导出博客数据
                </button>
                <button class="data-btn" id="importDataBtn">
                    <i class="fas fa-file-import"></i> 导入博客数据
                </button>
                <button class="data-btn" id="downloadHtmlBtn">
                    <i class="fas fa-download"></i> 下载HTML文件
                </button>
                <button class="data-btn" id="clearDataBtn">
                    <i class="fas fa-trash-alt"></i> 清除所有数据
                </button>
                <button class="data-btn" id="closeDataPanelBtn">
                    <i class="fas fa-times"></i> 关闭面板
                </button>
            </div>
        </div>
    </div>

    <script>
        // 博客数据结构
        let blogData = {
            categories: [],
            posts: [],
            currentPost: null,
            currentCategory: null
        };
        
        // DOM元素
        const DOM = {
            createPostBtn: document.getElementById('createPostBtn'),
            createCategoryBtn: document.getElementById('createCategoryBtn'),
            dataManagementBtn: document.getElementById('dataManagementBtn'),
            postModal: document.getElementById('postModal'),
            categoryModal: document.getElementById('categoryModal'),
            dataPanel: document.getElementById('dataPanel'),
            postsContainer: document.getElementById('postsContainer'),
            postList: document.getElementById('postList'),
            categoryList: document.getElementById('categoryList'),
            existingCategories: document.getElementById('existingCategories'),
            postTitle: document.getElementById('postTitle'),
            postCategory: document.getElementById('postCategory'),
            postContent: document.getElementById('postContent'),
            categoryName: document.getElementById('categoryName'),
            previewArea: document.getElementById('previewArea'),
            postCounter: document.getElementById('postCounter'),
            storageInfo: document.getElementById('storageInfo'),
            emptyState: document.getElementById('emptyState'),
            savePostBtn: document.getElementById('savePostBtn'),
            saveCategoryBtn: document.getElementById('saveCategoryBtn'),
            deletePostBtn: document.getElementById('deletePostBtn'),
            deleteCategoryBtn: document.getElementById('deleteCategoryBtn'),
            cancelPostBtn: document.getElementById('cancelPostBtn'),
            cancelCategoryBtn: document.getElementById('cancelCategoryBtn'),
            exportDataBtn: document.getElementById('exportDataBtn'),
            importDataBtn: document.getElementById('importDataBtn'),
            downloadHtmlBtn: document.getElementById('downloadHtmlBtn'),
            clearDataBtn: document.getElementById('clearDataBtn'),
            closeDataPanelBtn: document.getElementById('closeDataPanelBtn')
        };
        
        // 初始化博客
        function initializeBlog() {
            loadData();
            renderCategories();
            renderPosts();
            setupEventListeners();
            setupMarkdownPreview();
        }
        
        // 加载本地存储的数据
        function loadData() {
            const savedData = localStorage.getItem('blogData');
            if (savedData) {
                try {
                    blogData = JSON.parse(savedData);
                    DOM.storageInfo.textContent = `已加载 ${blogData.posts.length} 篇文章，${blogData.categories.length} 个分类`;
                } catch (e) {
                    console.error("数据解析失败", e);
                    initializeSampleData();
                }
            } else {
                initializeSampleData();
            }
            
            // 更新计数器
            DOM.postCounter.textContent = blogData.posts.length;
        }
        
        // 初始化示例数据
        function initializeSampleData() {
            blogData.categories = [
                { id: generateId(), name: '技术分享' },
                { id: generateId(), name: '生活随笔' },
                { id: generateId(), name: '学习笔记' }
            ];
            
            blogData.posts = [
                { 
                    id: generateId(), 
                    title: '欢迎来到庞和合的博客', 
                    content: '# 欢迎\n这是我的第一篇博客文章，欢迎光临！\n\n## Markdown 示例\n\n- 列表项\n- **粗体文本**\n- *斜体文本*\n\n`console.log("Hello World!");`\n\n> 使用Markdown编辑内容真方便！',
                    category: blogData.categories[0].id,
                    createdAt: new Date().toISOString()
                },
                { 
                    id: generateId(), 
                    title: 'Markdown使用指南', 
                    content: '## Markdown 是什么？\n\nMarkdown是一种轻量级标记语言，允许人们使用易读易写的纯文本格式编写文档。\n\n### 常用语法\n\n1. 标题：`# 一级标题` `## 二级标题`\n2. 列表：`- 无序列表` `1. 有序列表`\n3. 链接：``\n4. 代码块：\\`\\`\\`javascript\n   console.log("代码");\n   \\`\\`\\`\n\n> 掌握Markdown，让写作更高效！',
                    category: blogData.categories[2].id,
                    createdAt: new Date().toISOString()
                }
            ];
            
            saveData();
            DOM.storageInfo.textContent = `已创建初始数据：${blogData.posts.length} 篇文章`;
        }
        
        // 保存数据到本地存储
        function saveData() {
            localStorage.setItem('blogData', JSON.stringify(blogData));
            DOM.storageInfo.textContent = `已保存 ${blogData.posts.length} 篇文章，${blogData.categories.length} 个分类`;
        }
        
        // 生成唯一ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
        }
        
        // 渲染分类列表
        function renderCategories() {
            DOM.categoryList.innerHTML = '';
            DOM.postCategory.innerHTML = '';
            
            blogData.categories.forEach(category => {
                // 添加到分类列表
                const categoryElement = document.createElement('li');
                categoryElement.className = 'category-item';
                categoryElement.dataset.id = category.id;
                categoryElement.innerHTML = `
                    <span>${category.name}</span>
                    <div class="item-actions">
                        <i class="fas fa-edit edit-category"></i>
                    </div>
                `;
                DOM.categoryList.appendChild(categoryElement);
                
                // 添加到文章分类选项
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                DOM.postCategory.appendChild(option);
            });
            
            // 渲染已有分类列表
            renderExistingCategories();
        }
        
        // 渲染已有分类列表
        function renderExistingCategories() {
            DOM.existingCategories.innerHTML = '';
            
            if (blogData.categories.length === 0) {
                DOM.existingCategories.innerHTML = '<p style="color:#777; text-align:center;">暂无分类</p>';
                return;
            }
            
            blogData.categories.forEach(category => {
                const li = document.createElement('li');
                li.className = 'category-item';
                li.style.marginBottom = '8px';
                li.innerHTML = `
                    <span>${category.name}</span>
                    <div class="item-actions">
                        <i class="fas fa-edit edit-existing-category" data-id="${category.id}"></i>
                        <i class="fas fa-trash-alt delete-existing-category" data-id="${category.id}"></i>
                    </div>
                `;
                DOM.existingCategories.appendChild(li);
            });
        }
        
        // 渲染文章列表
        function renderPosts() {
            DOM.postList.innerHTML = '';
            
            blogData.posts.forEach(post => {
                const category = blogData.categories.find(c => c.id === post.category);
                
                const postElement = document.createElement('li');
                postElement.className = 'post-item';
                postElement.dataset.id = post.id;
                postElement.innerHTML = `
                    <span>${post.title}</span>
                    <div class="item-actions">
                        <i class="fas fa-edit edit-post"></i>
                        <i class="fas fa-trash-alt delete-post"></i>
                    </div>
                `;
                DOM.postList.appendChild(postElement);
            });
            
            // 渲染博客文章卡片
            renderPostCards();
        }
        
        // 渲染文章卡片
        function renderPostCards() {
            DOM.postsContainer.innerHTML = '';
            
            if (blogData.posts.length === 0) {
                DOM.emptyState.style.display = 'flex';
                return;
            }
            
            DOM.emptyState.style.display = 'none';
            
            blogData.posts.forEach(post => {
                const category = blogData.categories.find(c => c.id === post.category);
                const date = new Date(post.createdAt).toLocaleDateString();
                const excerpt = marked.parse(post.content).replace(/<[^>]*>/g, '').substring(0, 150) + '...';
                
                const postCard = document.createElement('div');
                postCard.className = 'post-card';
                postCard.dataset.id = post.id;
                postCard.innerHTML = `
                    <div class="card-header">
                        <div class="category-badge">${category?.name || '未分类'}</div>
                    </div>
                    <div class="card-content">
                        <h3>${post.title}</h3>
                        <p>${excerpt}</p>
                    </div>
                    <div class="card-footer">
                        <span><i class="fas fa-calendar-alt"></i> ${date}</span>
                    </div>
                `;
                DOM.postsContainer.appendChild(postCard);
            });
        }
        
        // 设置Markdown预览
        function setupMarkdownPreview() {
            DOM.postContent.addEventListener('input', function() {
                DOM.previewArea.innerHTML = marked.parse(this.value);
            });
        }
        
        // 初始化事件监听
        function setupEventListeners() {
            // 新建文章按钮
            DOM.createPostBtn.addEventListener('click', () => {
                blogData.currentPost = null;
                DOM.postTitle.value = '';
                DOM.postContent.value = '';
                DOM.previewArea.innerHTML = '<p style="color:#888;">预览内容将在这里显示...</p>';
                DOM.postModal.classList.add('active');
            });
            
            // 新建分类按钮
            DOM.createCategoryBtn.addEventListener('click', () => {
                blogData.currentCategory = null;
                DOM.categoryName.value = '';
                DOM.categoryModal.classList.add('active');
            });
            
            // 数据管理按钮
            DOM.dataManagementBtn.addEventListener('click', () => {
                DOM.dataPanel.classList.add('active');
            });
            
            // 关闭数据面板
            DOM.closeDataPanelBtn.addEventListener('click', () => {
                DOM.dataPanel.classList.remove('active');
            });
            
            // 导出数据
            DOM.exportDataBtn.addEventListener('click', exportData);
            
            // 导入数据
            DOM.importDataBtn.addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = e => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const data = JSON.parse(event.target.result);
                            if (data.categories && data.posts) {
                                blogData = data;
                                saveData();
                                renderCategories();
                                renderPosts();
                                alert('数据导入成功！');
                            } else {
                                alert('导入失败：无效的数据格式');
                            }
                        } catch (error) {
                            alert('导入失败：' + error.message);
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            });
            
            // 下载HTML文件
            DOM.downloadHtmlBtn.addEventListener('click', downloadHtml);
            
            // 清除所有数据
            DOM.clearDataBtn.addEventListener('click', () => {
                if (confirm('确定要清除所有数据吗？此操作不可恢复！')) {
                    localStorage.removeItem('blogData');
                    initializeSampleData();
                    renderCategories();
                    renderPosts();
                    alert('数据已重置为初始状态');
                }
            });
            
            // 保存文章
            DOM.savePostBtn.addEventListener('click', savePost);
            
            // 保存分类
            DOM.saveCategoryBtn.addEventListener('click', saveCategory);
            
            // 删除文章
            DOM.deletePostBtn.addEventListener('click', deletePost);
            
            // 删除分类
            DOM.deleteCategoryBtn.addEventListener('click', deleteCategory);
            
            // 取消操作
            DOM.cancelPostBtn.addEventListener('click', () => DOM.postModal.classList.remove('active'));
            DOM.cancelCategoryBtn.addEventListener('click', () => DOM.categoryModal.classList.remove('active'));
            
            // 分类列表事件委托
            DOM.categoryList.addEventListener('click', event => {
                if (event.target.classList.contains('edit-category')) {
                    const categoryId = event.target.closest('.category-item').dataset.id;
                    editCategory(categoryId);
                }
            });
            
            // 文章列表事件委托
            DOM.postList.addEventListener('click', event => {
                const postItem = event.target.closest('.post-item');
                if (!postItem) return;
                
                const postId = postItem.dataset.id;
                
                if (event.target.classList.contains('edit-post')) {
                    editPost(postId);
                } else if (event.target.classList.contains('delete-post')) {
                    deletePost(postId);
                } else {
                    // 点击文章项
                    viewPost(postId);
                }
            });
            
            // 分类管理中的编辑/删除按钮
            DOM.existingCategories.addEventListener('click', event => {
                if (event.target.classList.contains('edit-existing-category')) {
                    const categoryId = event.target.dataset.id;
                    editCategory(categoryId);
                } else if (event.target.classList.contains('delete-existing-category')) {
                    const categoryId = event.target.dataset.id;
                    deleteCategory(categoryId);
                }
            });
            
            // 点击关闭模态框（点击模态框外部）
            document.addEventListener('click', event => {
                if (event.target.classList.contains('modal')) {
                    DOM.postModal.classList.remove('active');
                    DOM.categoryModal.classList.remove('active');
                }
                if (event.target.classList.contains('data-panel')) {
                    DOM.dataPanel.classList.remove('active');
                }
            });
        }
        
        // 导出数据
        function exportData() {
            const dataStr = JSON.stringify(blogData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `blog-data-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('数据已导出，请保存文件用于备份或迁移');
        }
        
        // 下载HTML文件
        function downloadHtml() {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'panghehe-blog.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('HTML文件已下载，可用于部署到GitHub Pages');
        }
        
        // 编辑文章
        function editPost(postId) {
            const post = blogData.posts.find(p => p.id === postId);
            if (!post) return;
            
            blogData.currentPost = postId;
            DOM.postTitle.value = post.title;
            DOM.postContent.value = post.content;
            
            // 设置当前分类
            DOM.postCategory.value = post.category;
            
            // 更新预览
            DOM.previewArea.innerHTML = marked.parse(post.content);
            
            DOM.postModal.classList.add('active');
        }
        
        // 查看文章
        function viewPost(postId) {
            // 这里可以扩展为单篇文章详细视图
            editPost(postId);
        }
        
        // 保存文章
        function savePost() {
            const title = DOM.postTitle.value.trim();
            const content = DOM.postContent.value.trim();
            const category = DOM.postCategory.value;
            
            if (!title || !content || !category) {
                alert('请填写标题、内容和选择分类');
                return;
            }
            
            if (blogData.currentPost) {
                // 更新现有文章
                const postIndex = blogData.posts.findIndex(p => p.id === blogData.currentPost);
                if (postIndex !== -1) {
                    blogData.posts[postIndex].title = title;
                    blogData.posts[postIndex].content = content;
                    blogData.posts[postIndex].category = category;
                }
            } else {
                // 创建新文章
                const newPost = {
                    id: generateId(),
                    title,
                    content,
                    category,
                    createdAt: new Date().toISOString()
                };
                blogData.posts.push(newPost);
            }
            
            saveData();
            renderPosts();
            DOM.postModal.classList.remove('active');
        }
        
        // 删除文章
        function deletePost(postId) {
            if (!postId) {
                postId = blogData.currentPost;
            }
            
            if (!postId) return;
            
            if (!confirm('确定要删除这篇文章吗？')) return;
            
            blogData.posts = blogData.posts.filter(post => post.id !== postId);
            
            // 更新计数器
            DOM.postCounter.textContent = blogData.posts.length;
            
            saveData();
            renderPosts();
            DOM.postModal.classList.remove('active');
        }
        
        // 编辑分类
        function editCategory(categoryId) {
            const category = blogData.categories.find(c => c.id === categoryId);
            if (!category) return;
            
            blogData.currentCategory = categoryId;
            DOM.categoryName.value = category.name;
            DOM.categoryModal.classList.add('active');
        }
        
        // 保存分类
        function saveCategory() {
            const name = DOM.categoryName.value.trim();
            if (!name) {
                alert('请填写分类名称');
                return;
            }
            
            if (blogData.currentCategory) {
                // 更新现有分类
                const categoryIndex = blogData.categories.findIndex(c => c.id === blogData.currentCategory);
                if (categoryIndex !== -1) {
                    blogData.categories[categoryIndex].name = name;
                }
            } else {
                // 创建新分类
                const newCategory = {
                    id: generateId(),
                    name
                };
                blogData.categories.push(newCategory);
            }
            
            saveData();
            renderCategories();
            DOM.categoryModal.classList.remove('active');
        }
        
        // 删除分类
        function deleteCategory(categoryId) {
            if (!categoryId) {
                categoryId = blogData.currentCategory;
            }
            
            if (!categoryId) return;
            
            // 检查分类是否被使用
            const postsUsingCategory = blogData.posts.filter(post => post.category === categoryId);
            if (postsUsingCategory.length > 0) {
                alert('该分类已被使用，无法删除');
                return;
            }
            
            if (!confirm('确定要删除这个分类吗？')) return;
            
            blogData.categories = blogData.categories.filter(cat => cat.id !== categoryId);
            
            saveData();
            renderCategories();
            DOM.categoryModal.classList.remove('active');
        }
        
        // 页面加载后初始化
        window.addEventListener('DOMContentLoaded', initializeBlog);
    </script>
</body>
</html>
