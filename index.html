<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人博客 - GitHub Gist同步</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4285f4;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #202124;
            --border-color: #dadce0;
            --shadow: 0 1px 2px rgba(0,0,0,0.1);
            --hover-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: all 0.3s;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* 页眉样式 */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }
        
        .logo i {
            margin-right: 8px;
        }
        
        .sync-status {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            padding: 5px 10px;
            border-radius: 4px;
            background: #e8f0fe;
            color: #1a73e8;
        }
        
        .sync-status .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #34a853;
            margin-right: 7px;
        }
        
        .sync-status.syncing .dot {
            background: #fbbc05;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        nav li {
            margin-left: 15px;
        }
        
        nav a {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 4px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }
        
        nav a i {
            margin-right: 5px;
        }
        
        nav a:hover, nav a.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* 主内容区 */
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (min-width: 992px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        /* 文章列表 */
        .articles-container {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .articles-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .filter-controls {
            display: flex;
            gap: 8px;
        }
        
        .filter-btn {
            background-color: #f1f3f4;
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .articles-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .article-item {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .article-item:hover {
            border-color: var(--primary-color);
            box-shadow: var(--hover-shadow);
            transform: translateY(-2px);
        }
        
        .article-item.active {
            border-left: 4px solid var(--primary-color);
        }
        
        .article-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .article-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
            word-break: break-word;
        }
        
        .article-meta {
            display: flex;
            font-size: 0.85rem;
            color: #5f6368;
        }
        
        .article-category {
            background-color: #e8f0fe;
            color: var(--primary-color);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }
        
        .article-content {
            color: #5f6368;
            font-size: 0.95rem;
            margin-top: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .article-actions {
            display: flex;
            gap: 12px;
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px dashed var(--border-color);
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            color: #5f6368;
            cursor: pointer;
        }
        
        .action-btn i {
            margin-right: 5px;
        }
        
        .delete-btn {
            color: #ea4335;
        }
        
        /* 编辑器和预览 */
        .editor-container {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 600px;
        }
        
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .editor-controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        @media (min-width: 768px) {
            .editor-controls {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            background-color: white;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
        }
        
        .editor-body {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            flex-grow: 1;
        }
        
        @media (min-width: 768px) {
            .editor-body {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .markdown-editor, .markdown-preview {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .markdown-editor {
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .markdown-preview {
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 15px;
            overflow-y: auto;
        }
        
        .markdown-editor textarea {
            width: 100%;
            height: 100%;
            min-height: 200px;
            border: none;
            resize: none;
            font-family: 'Fira Code', Consolas, monospace;
            font-size: 15px;
            padding: 15px;
            background-color: #f6f8fa;
        }
        
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #3367d6;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        .btn-outline:hover {
            background-color: #e8f0fe;
        }
        
        /* 分类管理 */
        .categories-container {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .categories-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .categories-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .category-item {
            display: flex;
            align-items: center;
            padding: 6px 12px 6px 15px;
            background-color: #e8f0fe;
            border-radius: 20px;
            color: var(--primary-color);
        }
        
        .category-item .delete {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
            cursor: pointer;
            color: #ea4335;
            font-weight: bold;
        }
        
        .add-category {
            display: flex;
            margin-top: 15px;
        }
        
        .add-category input {
            flex-grow: 1;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px 0 0 6px;
            font-size: 1rem;
        }
        
        .add-category button {
            border-radius: 0 6px 6px 0;
        }
        
        /* Gist配置 */
        .gist-config {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 25px;
            margin-top: 15px;
        }
        
        .gist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .gist-details {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            font-family: monospace;
            margin: 15px 0;
            overflow-x: auto;
        }
        
        .gist-instructions {
            background-color: #e8f0fe;
            border-left: 3px solid var(--primary-color);
            padding: 15px;
            border-radius: 0 6px 6px 0;
            font-size: 0.9rem;
            margin-top: 15px;
        }
        
        /* 页脚样式 */
        footer {
            text-align: center;
            padding: 25px 0;
            margin-top: 40px;
            color: #5f6368;
            border-top: 1px solid var(--border-color);
            font-size: 0.9rem;
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            nav ul {
                margin-top: 15px;
                width: 100%;
            }
            
            nav li {
                margin-left: 0;
                margin-right: 10px;
                margin-bottom: 5px;
            }
            
            .sync-status {
                margin-top: 10px;
            }
            
            .editor-controls {
                grid-template-columns: 1fr;
            }
        }
        
        /* 消息提示 */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            background-color: #34a853;
            color: white;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .toast i {
            margin-right: 10px;
        }
        
        .toast.error {
            background-color: #ea4335;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-blog"></i> 我的博客
            </div>
            <div class="sync-status" id="syncStatus">
                <span class="dot"></span>
                <span id="syncText">已同步</span>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="active" id="listTab"><i class="fas fa-list"></i> 文章列表</a></li>
                    <li><a href="#" id="writeTab"><i class="fas fa-edit"></i> 写文章</a></li>
                    <li><a href="#" id="categoriesTab"><i class="fas fa-tags"></i> 管理分类</a></li>
                </ul>
            </nav>
        </header>

        <div class="main-content">
            <!-- 文章列表区 -->
            <div class="articles-container" id="articlesSection">
                <div class="articles-header">
                    <h2>所有文章</h2>
                    <div class="filter-controls">
                        <button class="filter-btn active" data-category="all">全部</button>
                        <button class="filter-btn" data-category="技术">技术</button>
                        <button class="filter-btn" data-category="生活">生活</button>
                    </div>
                </div>
                <div class="articles-list" id="articlesList">
                    <!-- 文章将通过JS动态加载 -->
                </div>
            </div>

            <!-- 编辑区 -->
            <div class="editor-container" id="editorSection" style="display: none;">
                <div class="editor-header">
                    <h2>编辑文章</h2>
                    <button class="btn btn-primary" id="saveArticleBtn">
                        <i class="fas fa-save"></i> 保存
                    </button>
                </div>
                <div class="editor-controls">
                    <div class="form-group">
                        <label for="articleTitle">标题</label>
                        <input type="text" id="articleTitle" placeholder="输入文章标题">
                    </div>
                    <div class="form-group">
                        <label for="articleCategory">分类</label>
                        <select id="articleCategory">
                            <option value="技术">技术</option>
                            <option value="生活">生活</option>
                            <option value="旅行">旅行</option>
                            <option value="读书">读书</option>
                        </select>
                    </div>
                </div>
                <div class="editor-body">
                    <div class="markdown-editor">
                        <label for="markdownInput">Markdown内容</label>
                        <textarea id="markdownInput" placeholder="在此输入Markdown内容..."></textarea>
                    </div>
                    <div class="markdown-preview">
                        <label>预览</label>
                        <div id="markdownPreview"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 分类管理区 -->
        <div class="categories-container" id="categoriesSection" style="display: none;">
            <div class="categories-header">
                <h2>文章分类</h2>
                <button class="btn btn-outline" id="backToListBtn">
                    <i class="fas fa-arrow-left"></i> 返回列表
                </button>
            </div>
            <div class="categories-list" id="categoriesList">
                <!-- 分类将通过JS动态加载 -->
            </div>
            <div class="add-category">
                <input type="text" id="newCategory" placeholder="添加新分类...">
                <button class="btn btn-primary" id="addCategoryBtn">
                    <i class="fas fa-plus"></i> 添加
                </button>
            </div>
        </div>

        <!-- Gist配置 -->
        <div class="gist-config">
            <div class="gist-header">
                <h2>GitHub Gist配置</h2>
                <button class="btn btn-primary" id="syncNowBtn">
                    <i class="fas fa-sync-alt"></i> 立即同步
                </button>
            </div>
            <p>此博客使用GitHub Gist存储数据，实现跨设备同步。所有文章和分类信息都安全存储在您的GitHub账户中。</p>
            
            <div class="gist-details" id="gistDetails">
                Gist ID: <span id="gistIdDisplay">尚未配置</span><br>
                上次同步: <span id="lastSync">从未同步</span>
            </div>
            
            <div class="gist-instructions">
                <p><strong>使用说明:</strong></p>
                <ol>
                    <li>如果您是新用户，点击下方按钮创建一个新Gist</li>
                    <li>如果您已有存储博客数据的Gist，请输入Gist ID</li>
                    <li>数据将在所有设备上同步，只需使用相同Gist ID</li>
                    <li>所有更改将自动保存到GitHub Gist</li>
                </ol>
            </div>
            
            <div class="form-group" style="margin-top: 20px;">
                <label for="gistIdInput">Gist ID</label>
                <input type="text" id="gistIdInput" placeholder="输入或创建Gist ID">
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn btn-primary" id="createGistBtn">
                    <i class="fab fa-github"></i> 创建新Gist
                </button>
                <button class="btn btn-outline" id="saveGistBtn">
                    <i class="fas fa-check"></i> 保存配置
                </button>
            </div>
        </div>

        <footer>
            <p>简洁个人博客系统 &copy; 2023 | 基于GitHub Gist实现跨设备同步</p>
        </footer>
    </div>

    <!-- 消息提示 -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">操作成功</span>
    </div>

    <script>
        // 博客数据结构
        let blogData = {
            articles: [],
            categories: ["技术", "生活", "旅行", "读书"],
            lastUpdated: new Date().toISOString()
        };
        
        // DOM元素
        const elements = {
            articlesSection: document.getElementById('articlesSection'),
            editorSection: document.getElementById('editorSection'),
            categoriesSection: document.getElementById('categoriesSection'),
            articlesList: document.getElementById('articlesList'),
            categoriesList: document.getElementById('categoriesList'),
            articleTitle: document.getElementById('articleTitle'),
            articleCategory: document.getElementById('articleCategory'),
            markdownInput: document.getElementById('markdownInput'),
            markdownPreview: document.getElementById('markdownPreview'),
            newCategory: document.getElementById('newCategory'),
            syncStatus: document.getElementById('syncStatus'),
            syncText: document.getElementById('syncText'),
            toast: document.getElementById('toast'),
            toastMessage: document.getElementById('toastMessage'),
            gistIdDisplay: document.getElementById('gistIdDisplay'),
            lastSync: document.getElementById('lastSync'),
            gistIdInput: document.getElementById('gistIdInput')
        };
        
        // 当前选中的文章
        let currentArticle = null;
        // Gist ID存储
        let gistId = localStorage.getItem('blog_gist_id');
        
        // 初始化函数
        function init() {
            // 设置导航标签事件
            document.getElementById('listTab').addEventListener('click', () => showSection('articles'));
            document.getElementById('writeTab').addEventListener('click', () => showSection('editor'));
            document.getElementById('categoriesTab').addEventListener('click', () => showSection('categories'));
            document.getElementById('backToListBtn').addEventListener('click', () => showSection('articles'));
            
            // 注册文章保存按钮
            document.getElementById('saveArticleBtn').addEventListener('click', saveArticle);
            
            // 分类管理按钮
            document.getElementById('addCategoryBtn').addEventListener('click', addCategory);
            
            // Gist配置按钮
            document.getElementById('saveGistBtn').addEventListener('click', saveGistConfig);
            document.getElementById('createGistBtn').addEventListener('click', createGist);
            document.getElementById('syncNowBtn').addEventListener('click', loadDataFromGist);
            
            // Markdown输入监听
            elements.markdownInput.addEventListener('input', updateMarkdownPreview);
            
            // 设置Gist ID显示
            if (gistId) {
                elements.gistIdDisplay.textContent = gistId;
                elements.gistIdInput.value = gistId;
                elements.lastSync.textContent = new Date().toLocaleString();
                
                // 尝试从Gist加载数据
                loadDataFromGist();
            } else {
                elements.gistIdDisplay.textContent = "尚未配置";
            }
            
            // 加载示例文章
            loadSampleData();
            
            // 初始预览
            updateMarkdownPreview();
        }
        
        // 显示特定区域
        function showSection(section) {
            elements.articlesSection.style.display = 'none';
            elements.editorSection.style.display = 'none';
            elements.categoriesSection.style.display = 'none';
            
            switch(section) {
                case 'articles':
                    elements.articlesSection.style.display = 'block';
                    break;
                case 'editor':
                    elements.editorSection.style.display = 'block';
                    break;
                case 'categories':
                    elements.categoriesSection.style.display = 'block';
                    renderCategories();
                    break;
            }
        }
        
        // 加载示例文章数据
        function loadSampleData() {
            blogData.articles = [
                {
                    id: 'article1',
                    title: '使用GitHub Gist构建个人博客系统',
                    content: '## 介绍\n\n本文介绍了如何利用GitHub Gist作为后端存储，构建一个简洁高效的个人博客系统...',
                    category: '技术',
                    createdAt: '2023-08-15T10:30:00Z',
                    updatedAt: '2023-08-15T10:30:00Z'
                },
                {
                    id: 'article2',
                    title: 'Markdown语法全解析',
                    content: '## Markdown简介\n\nMarkdown是一种轻量级的标记语言，用于格式化纯文本...',
                    category: '技术',
                    createdAt: '2023-08-10T14:45:00Z',
                    updatedAt: '2023-08-10T14:45:00Z'
                },
                {
                    id: 'article3',
                    title: '周末爬山记',
                    content: '## 登山开始\n\n上周末与友人一同登山，清晨5点就从山脚出发...',
                    category: '生活',
                    createdAt: '2023-08-05T08:20:00Z',
                    updatedAt: '2023-08-05T08:20:00Z'
                }
            ];
            
            renderArticles();
        }
        
        // 渲染文章列表
        function renderArticles() {
            elements.articlesList.innerHTML = '';
            
            blogData.articles.forEach(article => {
                const articleEl = document.createElement('div');
                articleEl.className = 'article-item';
                articleEl.dataset.id = article.id;
                
                articleEl.innerHTML = `
                    <div class="article-header">
                        <div>
                            <div class="article-title">${article.title}</div>
                            <div class="article-meta">
                                ${new Date(article.updatedAt).toLocaleDateString()}
                            </div>
                        </div>
                        <div class="article-category">${article.category}</div>
                    </div>
                    <div class="article-content">${article.content.substring(0, 100)}...</div>
                    <div class="article-actions">
                        <div class="action-btn edit-btn">
                            <i class="fas fa-edit"></i> 编辑
                        </div>
                        <div class="action-btn delete-btn">
                            <i class="fas fa-trash"></i> 删除
                        </div>
                    </div>
                `;
                
                // 添加编辑事件
                articleEl.querySelector('.edit-btn').addEventListener('click', () => {
                    currentArticle = article;
                    showSection('editor');
                    elements.articleTitle.value = article.title;
                    elements.articleCategory.value = article.category;
                    elements.markdownInput.value = article.content;
                    updateMarkdownPreview();
                });
                
                // 添加删除事件
                articleEl.querySelector('.delete-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (confirm(`确定要删除文章《${article.title}》吗？`)) {
                        deleteArticle(article.id);
                    }
                });
                
                elements.articlesList.appendChild(articleEl);
            });
            
            // 添加新文章按钮
            const newArticleBtn = document.createElement('div');
            newArticleBtn.className = 'article-item';
            newArticleBtn.innerHTML = `
                <div style="text-align: center; padding: 20px; color: var(--primary-color);">
                    <i class="fas fa-plus-circle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                    <div>添加新文章</div>
                </div>
            `;
            newArticleBtn.addEventListener('click', () => {
                currentArticle = null;
                showSection('editor');
                elements.articleTitle.value = '';
                elements.articleCategory.value = '技术';
                elements.markdownInput.value = '';
                updateMarkdownPreview();
            });
            
            elements.articlesList.appendChild(newArticleBtn);
        }
        
        // 渲染分类
        function renderCategories() {
            elements.categoriesList.innerHTML = '';
            
            blogData.categories.forEach(category => {
                const categoryEl = document.createElement('div');
                categoryEl.className = 'category-item';
                categoryEl.innerHTML = `
                    ${category}
                    <div class="delete" data-category="${category}">&times;</div>
                `;
                
                // 添加删除事件
                categoryEl.querySelector('.delete').addEventListener('click', (e) => {
                    const categoryName = e.target.dataset.category;
                    if (confirm(`确定要删除分类"${categoryName}"吗？`)) {
                        deleteCategory(categoryName);
                    }
                });
                
                elements.categoriesList.appendChild(categoryEl);
            });
        }
        
        // 更新Markdown预览
        function updateMarkdownPreview() {
            elements.markdownPreview.innerHTML = marked.parse(elements.markdownInput.value || '*输入内容将在这里预览*');
        }
        
        // 保存文章
        function saveArticle() {
            const title = elements.articleTitle.value.trim();
            const category = elements.articleCategory.value;
            const content = elements.markdownInput.value;
            
            if (!title) {
                showToast('请输入文章标题', 'error');
                return;
            }
            
            if (!content) {
                showToast('文章内容不能为空', 'error');
                return;
            }
            
            const now = new Date().toISOString();
            
            if (currentArticle) {
                // 更新现有文章
                currentArticle.title = title;
                currentArticle.category = category;
                currentArticle.content = content;
                currentArticle.updatedAt = now;
                showToast('文章更新成功');
            } else {
                // 添加新文章
                const newArticle = {
                    id: 'article' + Date.now(),
                    title,
                    content,
                    category,
                    createdAt: now,
                    updatedAt: now
                };
                blogData.articles.push(newArticle);
                currentArticle = newArticle;
                showToast('文章保存成功');
            }
            
            // 更新Gist数据
            updateGistData();
            
            // 返回列表
            setTimeout(() => {
                showSection('articles');
                renderArticles();
            }, 1000);
        }
        
        // 删除文章
        function deleteArticle(id) {
            blogData.articles = blogData.articles.filter(article => article.id !== id);
            renderArticles();
            showToast('文章已删除');
            updateGistData();
        }
        
        // 添加分类
        function addCategory() {
            const category = elements.newCategory.value.trim();
            
            if (!category) {
                showToast('请输入分类名称', 'error');
                return;
            }
            
            if (blogData.categories.includes(category)) {
                showToast('该分类已存在', 'error');
                return;
            }
            
            blogData.categories.push(category);
            renderCategories();
            elements.newCategory.value = '';
            showToast(`分类"${category}"已添加`);
            updateGistData();
        }
        
        // 删除分类
        function deleteCategory(category) {
            // 检查是否有文章使用此分类
            const articlesWithCategory = blogData.articles.filter(a => a.category === category);
            if (articlesWithCategory.length > 0) {
                showToast(`无法删除：有${articlesWithCategory.length}篇文章使用此分类`, 'error');
                return;
            }
            
            blogData.categories = blogData.categories.filter(c => c !== category);
            renderCategories();
            showToast(`分类"${category}"已删除`);
            updateGistData();
        }
        
        // 保存Gist配置
        function saveGistConfig() {
            const newGistId = elements.gistIdInput.value.trim();
            
            if (!newGistId) {
                showToast('请输入Gist ID', 'error');
                return;
            }
            
            gistId = newGistId;
            localStorage.setItem('blog_gist_id', gistId);
            elements.gistIdDisplay.textContent = gistId;
            showToast('Gist ID已保存');
            
            // 加载数据
            loadDataFromGist();
        }
        
        // 创建新Gist（模拟）
        function createGist() {
            // 在实际实现中，这里将调用GitHub API创建Gist
            const newGistId = 'gist_' + Math.random().toString(36).substr(2, 9);
            
            elements.gistIdInput.value = newGistId;
            saveGistConfig();
            showToast('新Gist已创建', 'success');
        }
        
        // 更新Gist数据（模拟）
        function updateGistData() {
            // 在实际实现中，这里将调用GitHub API更新Gist
            elements.lastSync.textContent = new Date().toLocaleString();
            elements.syncText.textContent = "同步中...";
            elements.syncStatus.classList.add('syncing');
            
            // 模拟同步延迟
            setTimeout(() => {
                showToast('数据已同步到Gist', 'success');
                elements.syncText.textContent = "已同步";
                elements.syncStatus.classList.remove('syncing');
            }, 1500);
        }
        
        // 从Gist加载数据（模拟）
        function loadDataFromGist() {
            if (!gistId) {
                showToast('请先配置Gist ID', 'error');
                return;
            }
            
            elements.syncText.textContent = "同步中...";
            elements.syncStatus.classList.add('syncing');
            
            // 模拟从Gist加载数据
            setTimeout(() => {
                // 在实际实现中，这里会解析真实数据
                showToast('数据已从Gist加载', 'success');
                elements.lastSync.textContent = new Date().toLocaleString();
                elements.syncText.textContent = "已同步";
                elements.syncStatus.classList.remove('syncing');
                
                // 重新渲染界面
                renderArticles();
                renderCategories();
            }, 2000);
        }
        
        // 显示消息提示
        function showToast(message, type = 'success') {
            elements.toastMessage.textContent = message;
            elements.toast.className = 'toast' + (type === 'error' ? ' error' : '');
            elements.toast.classList.add('show');
            
            setTimeout(() => {
                elements.toast.classList.remove('show');
            }, 3000);
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
